<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickGPT</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
        /* Default Light Theme */
        :root {
            --primary-color: #b3d8ff; /* Pastel blue for primary elements */
            --primary-light: #e9f3ff; /* Lighter pastel blue for backgrounds */
            --primary-text: #4e5b6d; /* Muted blue-gray for buttons and text */
            --primary-hover: #a1cfff; /* Slightly darker pastel blue for hover states */
            --background-color: #f7f9fc; /* Very light blue-gray background */
            --chat-bg: #ffffff; /* White chat background */
            --text-color: #4a4a4a; /* Dark gray for text */
            --text-secondary: #888888; /* Medium gray for secondary text */
            --border-color: #e8e8e8; /* Light gray for borders */
            --input-bg: #ffffff; /* White input background */
            --timestamp-color: #9fa6b0; /* Muted gray for timestamps */
            --user-bubble-bg: #e9f3ff; /* Light pastel blue for user messages */
            --system-bubble-bg: #ffffff; /* White for system messages */
            --separator-color: #f0f1f2; /* Very light gray for separators */
            --header-text: #4a4a4a; /* Header text color */
            --header-bg: #ffffff; /* Header background color */
            --dropdown-bg: rgba(0, 0, 0, 0.1); /* Dropdown background */
            --dropdown-text: #4a4a4a; /* Dropdown text color */
        }
        
        /* Dark Theme */
        [data-theme="dark"] {
            --primary-color: #4a6b8a; /* Dark blue for primary elements */
            --primary-light: #2c3e50; /* Darker blue for backgrounds */
            --primary-text: #e1e8f0; /* Light gray for buttons and text */
            --primary-hover: #5a7b9a; /* Slightly lighter blue for hover states */
            --background-color: #121212; /* Very dark gray background */
            --chat-bg: #1e1e1e; /* Dark gray chat background */
            --text-color: #f0f0f0; /* Off-white for text */
            --text-secondary: #b0b0b0; /* Light gray for secondary text */
            --border-color: #333333; /* Dark gray for borders */
            --input-bg: #2a2a2a; /* Darker gray input background */
            --timestamp-color: #9fa6b0; /* Muted gray for timestamps */
            --user-bubble-bg: #2c3e50; /* Dark blue for user messages */
            --system-bubble-bg: #2a2a2a; /* Dark gray for system messages */
            --separator-color: #333333; /* Dark gray for separators */
            --header-text: #f0f0f0; /* Header text color */
            --header-bg: #1e1e1e; /* Header background color */
            --dropdown-bg: rgba(255, 255, 255, 0.1); /* Dropdown background */
            --dropdown-text: #f0f0f0; /* Dropdown text color */
        }
        
        /* Pastel Blue Theme (current default) */
        [data-theme="pastel"] {
            --primary-color: #b3d8ff; /* Pastel blue for primary elements */
            --primary-light: #e9f3ff; /* Lighter pastel blue for backgrounds */
            --primary-text: #4e5b6d; /* Muted blue-gray for buttons and text */
            --primary-hover: #a1cfff; /* Slightly darker pastel blue for hover states */
            --background-color: #f7f9fc; /* Very light blue-gray background */
            --chat-bg: #ffffff; /* White chat background */
            --text-color: #4a4a4a; /* Dark gray for text */
            --text-secondary: #888888; /* Medium gray for secondary text */
            --border-color: #e8e8e8; /* Light gray for borders */
            --input-bg: #ffffff; /* White input background */
            --timestamp-color: #9fa6b0; /* Muted gray for timestamps */
            --user-bubble-bg: #e9f3ff; /* Light pastel blue for user messages */
            --system-bubble-bg: #ffffff; /* White for system messages */
            --separator-color: #f0f1f2; /* Very light gray for separators */
            --header-text: #4a4a4a; /* Header text color */
            --header-bg: #ffffff; /* Header background color */
            --dropdown-bg: rgba(0, 0, 0, 0.1); /* Dropdown background */
            --dropdown-text: #4a4a4a; /* Dropdown text color */
        }
        
        /* Forest Green Theme */
        [data-theme="forest"] {
            --primary-color: #7fc682; /* Forest green for primary elements */
            --primary-light: #e3f2e3; /* Light mint green for backgrounds */
            --primary-text: #2c502e; /* Dark green for buttons and text */
            --primary-hover: #6cb46f; /* Slightly darker green for hover states */
            --background-color: #f5f9f5; /* Very light mint background */
            --chat-bg: #ffffff; /* White chat background */
            --text-color: #445444; /* Dark green-gray for text */
            --text-secondary: #889988; /* Medium green-gray for secondary text */
            --border-color: #e2ebe2; /* Light green-gray for borders */
            --input-bg: #ffffff; /* White input background */
            --timestamp-color: #a0b0a0; /* Muted green-gray for timestamps */
            --user-bubble-bg: #e3f2e3; /* Light mint for user messages */
            --system-bubble-bg: #ffffff; /* White for system messages */
            --separator-color: #edf4ed; /* Very light green for separators */
            --header-text: #445444; /* Header text color */
            --header-bg: #ffffff; /* Header background color */
            --dropdown-bg: rgba(0, 0, 0, 0.1); /* Dropdown background */
            --dropdown-text: #445444; /* Dropdown text color */
        }
        
        /* Sunset Orange Theme */
        [data-theme="sunset"] {
            --primary-color: #ff9e7a; /* Sunset orange for primary elements */
            --primary-light: #ffeee6; /* Light peach for backgrounds */
            --primary-text: #6d4e47; /* Dark brown for buttons and text */
            --primary-hover: #ff8a61; /* Slightly darker orange for hover states */
            --background-color: #fff9f5; /* Very light peach background */
            --chat-bg: #ffffff; /* White chat background */
            --text-color: #5a4a45; /* Dark brown for text */
            --text-secondary: #9e8c85; /* Medium brown for secondary text */
            --border-color: #eee3dd; /* Light peach for borders */
            --input-bg: #ffffff; /* White input background */
            --timestamp-color: #b8a8a0; /* Muted brown for timestamps */
            --user-bubble-bg: #ffeee6; /* Light peach for user messages */
            --system-bubble-bg: #ffffff; /* White for system messages */
            --separator-color: #f5ece7; /* Very light peach for separators */
            --header-text: #5a4a45; /* Header text color */
            --header-bg: #ffffff; /* Header background color */
            --dropdown-bg: rgba(0, 0, 0, 0.1); /* Dropdown background */
            --dropdown-text: #5a4a45; /* Dropdown text color */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Inter, Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .chat-container {
            background-color: var(--chat-bg);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.06);
            width: 100%;
            max-width: 700px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 85vh;
        }

        .chat-header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 16px 20px;
            font-weight: 500;
            font-size: 16px;
            border-bottom: 1px solid var(--separator-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            font-weight: 600;
        }
        
        .logo-btn {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            color: var(--header-text);
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            padding: 0;
            transition: all 0.2s;
        }
        
        .logo-btn:hover {
            opacity: 0.8;
        }
        
        .logo-container {
            height: 30px;
            width: 30px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-container svg {
            height: 30px;
            width: 30px;
        }
        
        .app-logo {
            color: var(--primary-color);
        }
        
        .logo-background {
            fill: var(--primary-color);
        }
        
        .header-center {
            flex: 1;
            display: flex;
            justify-content: flex-start;
            margin-left: 20px;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn, .reset-btn, .clip-btn, .send-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-light);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reset-btn {
            width: 36px;
            height: 36px;
        }
        
        .control-btn svg, .reset-btn svg, .clip-btn svg, .send-btn svg {
            width: 18px;
            height: 18px;
        }
        
        .control-btn:hover, .reset-btn:hover, .clip-btn:hover, .send-btn:hover {
            background-color: var(--primary-color);
            color: var(--primary-text);
        }
        
        .control-btn:active, .reset-btn:active, .logo-btn:active, .clip-btn:active, .send-btn:active {
            transform: scale(0.95);
        }
        
        .hidden-selects {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }
        
        .drawer-chip-container {
            background-color: var(--separator-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2px 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: absolute;
            top: 100%; /* Position at the bottom edge of header */
            left: 50%;
            transform: translate(-50%, -50%); /* Center horizontally and vertically on the border line */
            z-index: 5;
        }
        
        .drawer-chip-container:hover {
            background-color: var(--primary-light);
        }
        
        .info-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            width: 100%;
            background-color: var(--chat-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 16px 20px;
            z-index: 1000;
            margin-top: 0;
            display: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            pointer-events: none;
            box-sizing: border-box;
            transform: translateY(-100%);
            transform-origin: bottom center;
        }
        
        .info-panel.visible {
            display: block;
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(0); }
        }
        
        .info-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .info-panel-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .info-content {
            padding: 0 12px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .info-label {
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .info-value {
            color: var(--text-color);
            font-weight: 600;
        }
        
        .model-dropdown, .theme-dropdown {
            font-size: 12px;
            background-color: transparent;
            padding: 2px 2px 2px 8px;
            margin: 0;
            font-weight: 400;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            outline: none;
            z-index: 2;
            color: var(--dropdown-text);
        }
        
        .dropdown-visible {
            display: block !important;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background-color: var(--chat-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 10;
            width: 150px;
        }

        .chat-messages {
            padding: 24px;
            flex-grow: 1;
            overflow-y: auto;
            background-color: var(--chat-bg);
        }

        .message {
            margin-bottom: 28px;
            animation: fadeIn 0.3s ease-in;
            position: relative;
        }

        .message-content {
            max-width: 85%;
        }

        .message-time {
            color: var(--timestamp-color);
            font-size: 12px;
            margin-top: 5px;
            display: inline-block;
            padding: 0 8px;
        }

        .user-message-container {
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            flex-direction: row;
            text-align: right;
            margin-left: auto;
        }

        .system-message-container {
            display: flex;
            align-items: flex-start;
        }

        .user-message {
            background-color: var(--system-bubble-bg);
            color: var(--text-color);
            border-radius: 18px;
            padding: 9px 14px;
            position: relative;
            box-shadow: none;
            font-size: 14px;
            line-height: 18px;
            border: 1px solid var(--border-color);
        }

        .system-message {
            background-color: var(--user-bubble-bg);
            color: var(--text-color);
            border-radius: 18px;
            padding: 9px 14px;
            position: relative;
            box-shadow: none;
            line-height: 1.5;
            font-size: 14px;
        }
        
        .system-message strong {
            font-weight: 600;
        }
        
        .system-message em {
            font-style: italic;
        }
        
        #loading-message {
            background-color: var(--chat-bg);
            animation: pulse 1.5s infinite;
            border: 1px solid var(--border-color);
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .message-body {
            font-size: 14.5px;
            line-height: 1.5;
        }
        
        .welcome-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            max-width: 90%;
            color: var(--text-color);
            opacity: 0.9;
            /* Center vertically in the chat area */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
        }
        
        .welcome-text {
            margin-bottom: 1.5rem;
            line-height: 1.8;
            text-align: center;
        }
        
        .welcome-text .title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .welcome-text .subtitle {
            font-size: 1.2rem;
        }
        
        .welcome-logo {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
            color: var(--primary-color);
        }
        
        .welcome-logo svg {
            width: 60px;
            height: 60px;
        }
        
        .welcome-input-container {
            width: 100%;
            display: flex;
            justify-content: center;
        }
        
        /* Custom input for welcome screen */
        .welcome-input {
            display: flex;
            margin-top: 2rem;
            width: 80%;
            max-width: 500px;
            border-radius: 20px;
            padding: 0.75rem 1.25rem;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 1rem;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .welcome-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-color);
        }

        .quick-answers-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            margin-top: 16px;
            margin-bottom: 16px;
            padding: 0 24px;
        }

        .quick-answers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            flex-grow: 1;
        }

        .quick-answer-btn {
            background-color: var(--chat-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 6px 14px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .quick-answer-btn:hover {
            background-color: var(--primary-light);
            border-color: var(--primary-color);
        }
        
        /* Separator line between chat and controls */
        .separator-line {
            height: 1px;
            width: 100%;
            background-color: var(--separator-color);
            margin: 0;
            transition: all 0.3s ease;
            position: relative;
            z-index: 999;
        }
        
        .separator-line.active {
            background-color: var(--separator-color);
            height: 1px;
        }
        
        /* Ellipsis chip for easier clicking - positioned in the middle */
        .separator-chip {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--separator-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2px 12px;
            min-width: 40px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }
        
        .triangle-up {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 10px solid var(--text-color);
        }
        
        .triangle-down {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 10px solid var(--text-color);
        }
        
        .separator-line.active .separator-chip {
            background-color: var(--separator-color);
            opacity: 1;
            pointer-events: auto;
        }

        /* Drawer style continue section */
        .continue-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%; /* Take full width of container */
            background-color: var(--chat-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            padding: 16px 20px;
            margin-top: 8px; /* Smaller than padding between suggestion chips and line */
            transition: opacity 0.3s ease, transform 0.3s ease;
            opacity: 0;
            pointer-events: none; /* Prevents clicks when hidden */
            box-sizing: border-box;
            transform: translateY(100%);
            transform-origin: top center;
        }
        
        .continue-section.visible {
            opacity: 1;
            pointer-events: auto; /* Re-enable clicks when visible */
            transform: translateY(0);
        }
        
        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .drawer-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .quit-btn {
            background-color: transparent;
            color: var(--text-color);
            border: none;
            border-radius: 50%;
            padding: 0;
            width: 32px;
            height: 32px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quit-btn svg {
            width: 16px;
            height: 16px;
        }
        
        .quit-btn:hover {
            background-color: var(--border-color);
        }

        .prompt-preview-container {
            position: relative;
            width: 100%;
        }
        
        .prompt-preview {
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 18px;
            padding: 12px 14px;
            height: 150px; /* Increased height */
            width: 100%;
            resize: none;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-color);
            outline: none;
            overflow-y: auto;
        }
        
        .prompt-preview:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-light);
        }

        .clip-btn {
            width: 32px;
            height: 32px;
        }
        
        .clip-btn svg {
            width: 16px;
            height: 16px;
        }

        .copy-notification {
            color: var(--text-color);
            background-color: var(--primary-light);
            border-radius: 12px;
            padding: 4px 10px;
            font-size: 13px;
            font-weight: 500;
            display: none;
            opacity: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: opacity 0.3s ease-in-out;
            z-index: 10;
        }

        .controls-container {
            display: flex;
            padding: 16px 24px;
            border-top: 1px solid var(--separator-color);
            background-color: var(--chat-bg);
            align-items: center;
        }

        .input-container {
            position: relative; /* For positioning the send button */
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            width: 100%;
        }

        .message-input {
            width: 100%;
            padding: 9px 14px;
            padding-right: 40px; /* Space for the send button */
            border: 1px solid var(--border-color);
            border-radius: 18px;
            resize: none;
            font-size: 14px;
            min-height: 36px;
            max-height: 150px;
            outline: none;
            transition: all 0.2s;
            background-color: var(--input-bg);
            color: var(--text-color);
            line-height: 18px;
        }

        .message-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 1px var(--primary-light);
        }
        
        .button-container {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
        }

        .send-btn {
            width: 30px;
            height: 30px;
        }

        .send-btn svg {
            width: 16px;
            height: 16px;
        }

        .send-btn:disabled {
            background-color: var(--border-color);
            color: #b5b5b5;
            border-color: var(--border-color);
            cursor: not-allowed;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .chat-messages {
                padding: 15px;
            }
            
            .controls-container {
                padding: 12px;
            }
            
            .quick-answers {
                padding: 0 15px;
            }
            
            .chat-container {
                height: 95vh;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-title">
                <button id="logoToggleBtn" class="logo-btn" title="Toggle between models">
                    <div id="logoContainer" class="logo-container">
                        <svg width="24" height="24" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg" class="app-logo">
                            <path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.843 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.843 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.153 26.6802 10.0939 26.4504 10.0939C26.2206 10.0939 25.9948 10.153 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0628C14.3065 10.262 14.2466 10.4881 14.2479 10.7181L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <span>QuickGPT</span>
                </button>
            </div>
            
            <div class="header-center">
                <!-- Info drawer chip -->
                <div class="drawer-chip-container" id="infoDrawerChip">
                    <div class="drawer-chip">
                        <div class="triangle-down"></div>
                    </div>
                </div>
                <!-- Info panel that shows when drawer chip is clicked -->
                <div class="info-panel" id="infoPanel">
                    <div class="info-panel-header">
                        <button class="quit-btn" id="closeInfoBtn" title="Close">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                        <div class="info-panel-title">QuickGPT Info</div>
                        <button class="clip-btn" id="copyInfoBtn" title="Copy to clipboard">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                            </svg>
                        </button>
                    </div>
                    <div class="info-content">
                        <div class="info-item">
                            <span class="info-label">Model:</span>
                            <span class="info-value" id="infoModel">Quick</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Theme:</span>
                            <span class="info-value" id="infoTheme">Light</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">API Status:</span>
                            <span class="info-value" id="infoApiStatus">Connected</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="reset-btn" id="resetBtn" title="Reset chat">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                </button>
                
                <button id="modelSwitchBtn" class="control-btn model-btn" title="Switch model">
                    <img src="model-switch-button.png" alt="Switch Model" width="24" height="24">
                </button>
                
                <button id="themeToggleBtn" class="control-btn theme-btn" title="Toggle between themes">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                
                <!-- Hidden selects for long press functionality -->
                <div class="hidden-selects">
                    <select id="modelSelect" class="model-dropdown" style="display: none;">
                        <option value="gpt-4o" selected>Quick</option>
                        <option value="gpt-4o-mini">Very quick</option>
                    </select>
                    
                    <select id="themeSelect" class="theme-dropdown" style="display: none;" title="Select theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="pastel">Pastel Blue</option>
                        <option value="forest">Forest Green</option>
                        <option value="sunset">Sunset Orange</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Welcome message with the new format -->
            <div class="welcome-message">
                <div class="welcome-text">
                    <span class="title">Welcome to QuickGPT 👋</span>
                    <div class="welcome-logo">
                        <svg width="41" height="41" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-2/3 w-2/3 transition-all" data-v0-t="icon">
                            <path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.843 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.843 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.153 26.6802 10.0939 26.4504 10.0939C26.2206 10.0939 25.9948 10.153 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0628C14.3065 10.262 14.2466 10.4881 14.2479 10.7181L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill="currentColor"></path>
                        </svg>
                    </div>
                    <span class="subtitle">
                        Quick conversations.
                        <br>
                        Instant answers.
                        <br>
                        Nothing saved.
                    </span>
                </div>
                <div class="welcome-input-container">
                    <input type="text" class="welcome-input" placeholder="What would you like to ask today?" id="welcomeInput">
                </div>
            </div>
        </div>
        
        <div class="quick-answers-container">
            <div class="quick-answers" id="quickAnswers" style="display: none;">
                <!-- Quick answer buttons will be dynamically inserted here -->
            </div>
        </div>
        
        <!-- Container for separator line and drawer to maintain proper positioning -->
        <div class="separator-container" style="position: relative; width: 100%;">
            <!-- Separator line that glows when a conversation is in progress -->
            <div class="separator-line" id="separatorLine">
                <div class="separator-chip">
                    <div class="triangle-up"></div>
                </div>
            </div>
            
            <!-- Drawer-style continue section - positioned inside separator container -->
            <div class="continue-section" id="continueSection" style="display: none;">
                <div class="drawer-header">
                    <button class="quit-btn" id="quitBtn" title="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                    <div class="drawer-title">Continue in ChatGPT</div>
                    <button class="clip-btn" id="clipBtn" title="Copy to clipboard">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                        </svg>
                    </button>
                </div>
                <div class="prompt-preview-container">
                    <textarea class="prompt-preview" id="promptPreview" placeholder="Conversation summary for ChatGPT..." spellcheck="false"></textarea>
                    <div class="copy-notification" id="copyNotification">✓ Copied to clipboard</div>
                </div>
            </div>
        </div>
        
        <div class="controls-container">
            <div class="input-container">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Type your message here..."
                    rows="1"></textarea>
                <!-- Send button removed as requested -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            const chatMessages = document.getElementById('chatMessages');
            const quickAnswers = document.getElementById('quickAnswers');
            const continueSection = document.getElementById('continueSection');
            const separatorLine = document.getElementById('separatorLine');
            const promptPreview = document.getElementById('promptPreview');
            const copyNotification = document.getElementById('copyNotification');
            const clipBtn = document.getElementById('clipBtn');
            const quitBtn = document.getElementById('quitBtn');
            const resetBtn = document.getElementById('resetBtn');
            const modelSelect = document.getElementById('modelSelect');
            const themeSelect = document.getElementById('themeSelect');
            const welcomeInput = document.getElementById('welcomeInput');
            const controlsContainer = document.querySelector('.controls-container');
            const modelSwitchBtn = document.getElementById('modelSwitchBtn');
            
            // Info panel elements
            const infoDrawerChip = document.getElementById('infoDrawerChip');
            const infoPanel = document.getElementById('infoPanel');
            const infoModel = document.getElementById('infoModel');
            const infoTheme = document.getElementById('infoTheme');
            const infoApiStatus = document.getElementById('infoApiStatus');
            
            let currentQuestion = '';
            let currentResponse = '';
            let currentModel = 'gpt-4o'; // Default model
            let currentTheme = localStorage.getItem('quickgpt-theme') || 'light'; // Default theme
            
            // Initialize theme from saved preference
            initTheme();
            
            // Initialize info panel content
            updateInfoPanel();
            
            // Hide the controls container initially when welcome message is showing
            if (document.querySelector('.welcome-message')) {
                controlsContainer.style.display = 'none';
            }
            
            // Handle Enter key to send message (improved version)
            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault(); // Prevent default new line
                    if (messageInput.value.trim() !== '') {
                        sendMessage();
                    }
                }
            });
            
            // Welcome input handler for Enter key
            welcomeInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault(); // Prevent form submission
                    const message = welcomeInput.value.trim();
                    if (message !== '') {
                        // Transfer the message to regular input
                        messageInput.value = message;
                        
                        // Show regular input container
                        controlsContainer.style.display = 'flex';
                        
                        // Send the message
                        sendMessage();
                        
                        // Clear welcome input
                        welcomeInput.value = '';
                    }
                }
            });
            
            // Get logo and theme toggle buttons
            const logoToggleBtn = document.getElementById('logoToggleBtn');
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const logoContainer = document.getElementById('logoContainer');
            
            // Long press detection variables
            let logoLongPressTimer;
            let themeLongPressTimer;
            const longPressDelay = 500; // milliseconds for long press
            
            // Load SVG logos asynchronously
            const rocketLogoPromise = fetch('quickgpt-logo-rocket.svg')
                .then(response => response.text());
                
            const jetLogoPromise = fetch('quickgpt-logo-jet.svg')
                .then(response => response.text());
                
            // Wait for both logos to load
            Promise.all([rocketLogoPromise, jetLogoPromise])
                .then(([rocketSvg, jetSvg]) => {
                    // Store logos in memory for quick switching
                    window.logoSvgs = {
                        rocket: rocketSvg,
                        jet: jetSvg
                    };
                    
                    // Update logo based on current model
                    updateLogo();
                })
                .catch(error => {
                    console.error('Error loading SVG logos:', error);
                    // Fallback in case SVG loading fails
                    logoContainer.innerHTML = `<div style="width:30px;height:30px;background:var(--primary-color);border-radius:50%;"></div>`;
                });
            
            // Logo/model toggle button click (cycle through options)
            logoToggleBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get current index
                const currentIndex = Array.from(modelSelect.options)
                    .findIndex(option => option.value === currentModel);
                
                // Calculate next index (cycle through options)
                const nextIndex = (currentIndex + 1) % modelSelect.options.length;
                
                // Set the new value
                modelSelect.selectedIndex = nextIndex;
                
                // Trigger the change event manually
                const changeEvent = new Event('change');
                modelSelect.dispatchEvent(changeEvent);
            });
            
            // Theme toggle button click (cycle through options)
            themeToggleBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get current index
                const currentIndex = Array.from(themeSelect.options)
                    .findIndex(option => option.value === currentTheme);
                
                // Calculate next index (cycle through options)
                const nextIndex = (currentIndex + 1) % themeSelect.options.length;
                
                // Set the new value
                themeSelect.selectedIndex = nextIndex;
                
                // Trigger the change event manually
                const changeEvent = new Event('change');
                themeSelect.dispatchEvent(changeEvent);
            });
            
            // Model switch button click (cycle through options)
            modelSwitchBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get current index
                const currentIndex = Array.from(modelSelect.options)
                    .findIndex(option => option.value === currentModel);
                
                // Calculate next index (cycle through options)
                const nextIndex = (currentIndex + 1) % modelSelect.options.length;
                
                // Set the new value
                modelSelect.selectedIndex = nextIndex;
                
                // Trigger the change event manually
                const changeEvent = new Event('change');
                modelSelect.dispatchEvent(changeEvent);
            });
            
            // Long press for logo/model select
            logoToggleBtn.addEventListener('mousedown', function(e) {
                e.preventDefault();
                logoLongPressTimer = setTimeout(() => {
                    showDropdown(modelSelect);
                }, longPressDelay);
            });
            
            logoToggleBtn.addEventListener('mouseup', function() {
                clearTimeout(logoLongPressTimer);
            });
            
            logoToggleBtn.addEventListener('mouseleave', function() {
                clearTimeout(logoLongPressTimer);
            });
            
            // Long press for theme select
            themeToggleBtn.addEventListener('mousedown', function(e) {
                e.preventDefault();
                themeLongPressTimer = setTimeout(() => {
                    showDropdown(themeSelect);
                }, longPressDelay);
            });
            
            themeToggleBtn.addEventListener('mouseup', function() {
                clearTimeout(themeLongPressTimer);
            });
            
            themeToggleBtn.addEventListener('mouseleave', function() {
                clearTimeout(themeLongPressTimer);
            });
            
            // Touch events for mobile devices
            logoToggleBtn.addEventListener('touchstart', function(e) {
                logoLongPressTimer = setTimeout(() => {
                    showDropdown(modelSelect);
                }, longPressDelay);
            });
            
            logoToggleBtn.addEventListener('touchend', function() {
                clearTimeout(logoLongPressTimer);
            });
            
            themeToggleBtn.addEventListener('touchstart', function(e) {
                themeLongPressTimer = setTimeout(() => {
                    showDropdown(themeSelect);
                }, longPressDelay);
            });
            
            themeToggleBtn.addEventListener('touchend', function() {
                clearTimeout(themeLongPressTimer);
            });
            
            // Function to show dropdown
            function showDropdown(selectElement) {
                // Position the select element where needed
                selectElement.style.display = 'block';
                selectElement.classList.add('dropdown-visible');
                
                // Focus the select to show dropdown
                selectElement.focus();
                
                // Hide dropdown when focus is lost
                selectElement.addEventListener('blur', function onBlur() {
                    selectElement.style.display = 'none';
                    selectElement.classList.remove('dropdown-visible');
                    selectElement.removeEventListener('blur', onBlur);
                });
                
                // Hide dropdown after selection is made
                selectElement.addEventListener('change', function onChange() {
                    selectElement.style.display = 'none';
                    selectElement.classList.remove('dropdown-visible');
                    selectElement.removeEventListener('change', onChange);
                });
            }
            
            // Function to update logo based on model
            function updateLogo() {
                // Check if SVGs are loaded
                if (!window.logoSvgs) return;
                
                // Select the appropriate SVG based on the current model
                const svgContent = currentModel === 'gpt-4o-mini' 
                    ? window.logoSvgs.jet   // Very quick = jet
                    : window.logoSvgs.rocket;  // Quick = rocket
                
                // Set the SVG content
                logoContainer.innerHTML = svgContent;
            }
            
            // Function to set up quick answer buttons 
            function setupQuickAnswerButtons() {
                document.querySelectorAll('.quick-answer-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const text = this.getAttribute('data-text');
                        addUserMessage(text);
                        simulateResponse(text);
                    });
                });
            }
            
            // Function to update quick answer buttons with new suggestions
            function updateQuickAnswers(suggestions) {
                // Clear existing buttons
                quickAnswers.innerHTML = '';
                
                // Create new buttons based on suggestions
                if (suggestions && Array.isArray(suggestions) && suggestions.length > 0) {
                    suggestions.forEach(suggestion => {
                        const button = document.createElement('button');
                        button.className = 'quick-answer-btn';
                        button.setAttribute('data-text', suggestion);
                        button.textContent = suggestion;
                        quickAnswers.appendChild(button);
                    });
                    
                    // Add event listeners to new buttons
                    setupQuickAnswerButtons();
                    
                    // Show quick answers section
                    quickAnswers.style.display = 'flex';
                } else {
                    // Hide quick answers if none available
                    quickAnswers.style.display = 'none';
                }
            }
            
            // Hide copy notification when the prompt is edited
            promptPreview.addEventListener('input', function() {
                // Hide the copy notification when editing
                copyNotification.style.display = 'none';
                copyNotification.style.opacity = '0';
            });
            
            // Toggle the visibility of the separator line when conversation starts
            function toggleSeparatorLine(show) {
                if (show) {
                    separatorLine.classList.add('active');
                } else {
                    separatorLine.classList.remove('active');
                }
            }
            
            // Separator line click handler to show drawer
            separatorLine.addEventListener('click', function() {
                console.log('Separator line clicked');
                console.log('Is active:', separatorLine.classList.contains('active'));
                
                // Debug check if elements exist
                console.log('Separator exists:', !!separatorLine);
                console.log('Drawer exists:', !!continueSection);
                
                if (separatorLine.classList.contains('active')) {
                    console.log('Attempting to show drawer');
                    // Make sure continueSection is properly initialized
                    if (continueSection) {
                        toggleContinueDrawer(true);
                    } else {
                        console.error('continueSection element not found');
                    }
                }
            });
            
            // Toggle the continue drawer visibility
            function toggleContinueDrawer(show) {
                console.log('Toggle drawer called with show:', show);
                if (show) {
                    // First ensure the element is in the DOM with display block
                    continueSection.style.display = 'block';
                    console.log('Set continueSection display to block');
                    
                    // Generate the prompt content if needed
                    if (promptPreview.value.trim() === '') {
                        console.log('Generating prompt content');
                        generateChatGPTPrompt();
                    }
                    
                    // Force a reflow before adding the visible class
                    void continueSection.offsetHeight;
                    
                    // Make the drawer visible with animation
                    console.log('Adding visible class to animate in');
                    continueSection.classList.add('visible');
                    
                    // Add listener to handle clicks outside the drawer
                    document.addEventListener('click', handleOutsideClick);
                } else {
                    // Hide with animation
                    console.log('Removing visible class to animate out');
                    continueSection.classList.remove('visible');
                    
                    // Remove from DOM after animation completes
                    setTimeout(() => {
                        console.log('Setting display to none');
                        continueSection.style.display = 'none';
                    }, 300); // Match transition duration
                    
                    // Remove outside click listener
                    document.removeEventListener('click', handleOutsideClick);
                }
            }
            
            // Handle clicks outside the drawer to close it
            function handleOutsideClick(event) {
                if (continueSection.classList.contains('visible')) {
                    const isClickInsideDrawer = continueSection.contains(event.target);
                    const isClickOnSeparator = separatorLine.contains(event.target);
                    
                    if (!isClickInsideDrawer && !isClickOnSeparator) {
                        toggleContinueDrawer(false);
                    }
                }
            }
            
            // Quit button click handler
            quitBtn.addEventListener('click', function() {
                toggleContinueDrawer(false);
            });
            
            // Clip button click handler
            clipBtn.addEventListener('click', function() {
                // Get the text from the prompt preview
                const text = promptPreview.value;
                
                // Copy to clipboard
                navigator.clipboard.writeText(text)
                    .then(() => {
                        // Show notification with fade-in effect
                        copyNotification.style.display = 'inline-block';
                        // Force a reflow to ensure the transition works
                        void copyNotification.offsetWidth;
                        copyNotification.style.opacity = '1';
                        
                        // Close the drawer after a short delay
                        setTimeout(() => {
                            toggleContinueDrawer(false);
                            
                            // Reset notification after drawer is closed
                            setTimeout(() => {
                                copyNotification.style.opacity = '0';
                                setTimeout(() => {
                                    copyNotification.style.display = 'none';
                                }, 300);
                            }, 500);
                        }, 1000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                    });
            });
            
            // Function to apply selected theme
            function applyTheme(theme) {
                // Remove any existing theme
                document.body.removeAttribute('data-theme');
                
                // If theme is not 'light' (default), add the theme attribute
                if (theme !== 'light') {
                    document.body.setAttribute('data-theme', theme);
                }
                
                // Save theme preference to localStorage
                localStorage.setItem('quickgpt-theme', theme);
                currentTheme = theme;
            }
            
            // Init theme on page load
            function initTheme() {
                // Set dropdown to saved theme
                themeSelect.value = currentTheme;
                
                // Apply the saved theme
                applyTheme(currentTheme);
            }
            
            // Theme selector change event
            themeSelect.addEventListener('change', function() {
                const selectedTheme = this.value;
                applyTheme(selectedTheme);
                // Update info panel with new theme
                updateInfoPanel();
                // No notification message, users can see theme change visually
            });
            
            // Model selector change event
            modelSelect.addEventListener('change', function() {
                // Update current model based on selection
                currentModel = this.value;
                console.log('Model changed to:', currentModel);
                
                // Update the logo to reflect model change
                updateLogo();
                
                // Update the info panel
                updateInfoPanel();
                
                // No notification message, users can see the logo change
            });
            
            // Info drawer chip click handler
            infoDrawerChip.addEventListener('click', function() {
                toggleInfoPanel();
            });
            
            // Close info panel button
            const closeInfoBtn = document.getElementById('closeInfoBtn');
            closeInfoBtn.addEventListener('click', function() {
                infoPanel.classList.remove('visible');
            });
            
            // Copy info panel data button
            const copyInfoBtn = document.getElementById('copyInfoBtn');
            copyInfoBtn.addEventListener('click', function() {
                const infoText = `QuickGPT Info:
Model: ${infoModel.textContent}
Theme: ${infoTheme.textContent}
API Status: ${infoApiStatus.textContent}`;
                
                navigator.clipboard.writeText(infoText).then(() => {
                    // Show notification
                    const copyNotification = document.createElement('div');
                    copyNotification.textContent = '✓ Copied to clipboard';
                    copyNotification.className = 'copy-notification';
                    copyNotification.style.display = 'block';
                    copyNotification.style.opacity = '1';
                    
                    // Append to info panel if not already present
                    if (!document.querySelector('.info-panel .copy-notification')) {
                        infoPanel.appendChild(copyNotification);
                    } else {
                        document.querySelector('.info-panel .copy-notification').style.display = 'block';
                        document.querySelector('.info-panel .copy-notification').style.opacity = '1';
                    }
                    
                    // Hide after delay
                    setTimeout(() => {
                        if (document.querySelector('.info-panel .copy-notification')) {
                            document.querySelector('.info-panel .copy-notification').style.opacity = '0';
                            setTimeout(() => {
                                document.querySelector('.info-panel .copy-notification').style.display = 'none';
                            }, 300);
                        }
                    }, 2000);
                });
            });
            
            // Function to toggle info panel visibility
            function toggleInfoPanel() {
                // Update the info panel data
                updateInfoPanel();
                
                // Toggle visibility
                infoPanel.classList.toggle('visible');
            }
            
            // Function to update info panel content
            function updateInfoPanel() {
                // Update model info
                infoModel.textContent = currentModel === 'gpt-4o' ? 'Quick' : 'Very quick';
                
                // Update theme info
                infoTheme.textContent = currentTheme.charAt(0).toUpperCase() + currentTheme.slice(1);
                
                // Check API status - simple for now
                const apiStatus = document.body.hasAttribute('data-api-error') ? 'Disconnected' : 'Connected';
                infoApiStatus.textContent = apiStatus;
            }
            
            // Reset chat button
            resetBtn.addEventListener('click', function() {
                // Clear messages and add welcome message with specific formatting
                chatMessages.innerHTML = `
                    <div class="welcome-message">
                        <div class="welcome-text">
                            <span class="title">Welcome to QuickGPT 👋</span>
                            <div class="welcome-logo">
                                <svg width="41" height="41" viewBox="0 0 41 41" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-2/3 w-2/3 transition-all" data-v0-t="icon">
                                    <path d="M37.5324 16.8707C37.9808 15.5241 38.1363 14.0974 37.9886 12.6859C37.8409 11.2744 37.3934 9.91076 36.676 8.68622C35.6126 6.83404 33.9882 5.3676 32.0373 4.4985C30.0864 3.62941 27.9098 3.40259 25.8215 3.85078C24.8796 2.7893 23.7219 1.94125 22.4257 1.36341C21.1295 0.785575 19.7249 0.491269 18.3058 0.500197C16.1708 0.495044 14.0893 1.16803 12.3614 2.42214C10.6335 3.67624 9.34853 5.44666 8.6917 7.47815C7.30085 7.76286 5.98686 8.3414 4.8377 9.17505C3.68854 10.0087 2.73073 11.0782 2.02839 12.312C0.956464 14.1591 0.498905 16.2988 0.721698 18.4228C0.944492 20.5467 1.83612 22.5449 3.268 24.1293C2.81966 25.4759 2.66413 26.9026 2.81182 28.3141C2.95951 29.7256 3.40701 31.0892 4.12437 32.3138C5.18791 34.1659 6.8123 35.6322 8.76321 36.5013C10.7141 37.3704 12.8907 37.5973 14.9789 37.1492C15.9208 38.2107 17.0786 39.0587 18.3747 39.6366C19.6709 40.2144 21.0755 40.5087 22.4946 40.4998C24.6307 40.5054 26.7133 39.8321 28.4418 38.5772C30.1704 37.3223 31.4556 35.5506 32.1119 33.5179C33.5027 33.2332 34.8167 32.6547 35.9659 31.821C37.115 30.9874 38.0728 29.9178 38.7752 28.684C39.8458 26.8371 40.3023 24.6979 40.0789 22.5748C39.8556 20.4517 38.9639 18.4544 37.5324 16.8707ZM22.4978 37.8849C20.7443 37.8874 19.0459 37.2733 17.6994 36.1501C17.7601 36.117 17.8666 36.0586 17.936 36.0161L25.9004 31.4156C26.1003 31.3019 26.2663 31.137 26.3813 30.9378C26.4964 30.7386 26.5563 30.5124 26.5549 30.2825V19.0542L29.9213 20.998C29.9389 21.0068 29.9541 21.0198 29.9656 21.0359C29.977 21.052 29.9842 21.0707 29.9867 21.0902V30.3889C29.9842 32.375 29.1946 34.2791 27.7909 35.6841C26.3872 37.0892 24.4838 37.8806 22.4978 37.8849ZM6.39227 31.0064C5.51397 29.4888 5.19742 27.7107 5.49804 25.9832C5.55718 26.0187 5.66048 26.0818 5.73461 26.1244L13.699 30.7248C13.8975 30.843 14.1233 30.902 14.3532 30.902C14.583 30.902 14.8088 30.843 15.0073 30.7248L24.731 25.1103V28.9979C24.7321 29.0177 24.7283 29.0376 24.7199 29.0556C24.7115 29.0736 24.6988 29.0893 24.6829 29.1012L16.6317 33.7497C14.9096 34.7416 12.8643 35.0097 10.9447 34.4954C9.02506 33.9811 7.38785 32.7263 6.39227 31.0064ZM4.29707 13.6194C5.17156 12.0998 6.55279 10.9364 8.19885 10.3327C8.19885 10.4013 8.19491 10.5228 8.19491 10.6071V19.808C8.19351 20.0378 8.25334 20.2638 8.36823 20.4629C8.48312 20.6619 8.64893 20.8267 8.84863 20.9404L18.5723 26.5542L15.206 28.4979C15.1894 28.5089 15.1703 28.5155 15.1505 28.5173C15.1307 28.5191 15.1107 28.516 15.0924 28.5082L7.04046 23.8557C5.32135 22.8601 4.06716 21.2235 3.55289 19.3046C3.03862 17.3858 3.30624 15.3413 4.29707 13.6194ZM31.955 20.0556L22.2312 14.4411L25.5976 12.4981C25.6142 12.4872 25.6333 12.4805 25.6531 12.4787C25.6729 12.4769 25.6928 12.4801 25.7111 12.4879L33.7631 17.1364C34.9967 17.849 36.0017 18.8982 36.6606 20.1613C37.3194 21.4244 37.6047 22.849 37.4832 24.2684C37.3617 25.6878 36.8382 27.0432 35.9743 28.1759C35.1103 29.3086 33.9415 30.1717 32.6047 30.6641C32.6047 30.5947 32.6047 30.4733 32.6047 30.3889V21.188C32.6066 20.9586 32.5474 20.7328 32.4332 20.5338C32.319 20.3348 32.154 20.1698 31.955 20.0556ZM35.3055 15.0128C35.2464 14.9765 35.1431 14.9142 35.069 14.8717L27.1045 10.2712C26.906 10.153 26.6802 10.0939 26.4504 10.0939C26.2206 10.0939 25.9948 10.153 25.7963 10.2712L16.0726 15.8858V11.9982C16.0715 11.9783 16.0753 11.9585 16.0837 11.9405C16.0921 11.9225 16.1048 11.9068 16.1207 11.8949L24.1719 7.25025C25.4053 6.53903 26.8158 6.19376 28.2383 6.25482C29.6608 6.31589 31.0364 6.78077 32.2044 7.59508C33.3723 8.40939 34.2842 9.53945 34.8334 10.8531C35.3826 12.1667 35.5464 13.6095 35.3055 15.0128ZM14.2424 21.9419L10.8752 19.9981C10.8576 19.9893 10.8423 19.9763 10.8309 19.9602C10.8195 19.9441 10.8122 19.9254 10.8098 19.9058V10.6071C10.8107 9.18295 11.2173 7.78848 11.9819 6.58696C12.7466 5.38544 13.8377 4.42659 15.1275 3.82264C16.4173 3.21869 17.8524 2.99464 19.2649 3.1767C20.6775 3.35876 22.0089 3.93941 23.1034 4.85067C23.0427 4.88379 22.937 4.94215 22.8668 4.98473L14.9024 9.58517C14.7025 9.69878 14.5366 9.86356 14.4215 10.0628C14.3065 10.262 14.2466 10.4881 14.2479 10.7181L14.2424 21.9419ZM16.071 17.9991L20.4018 15.4978L24.7325 17.9975V22.9985L20.4018 25.4983L16.071 22.9985V17.9991Z" fill="currentColor"></path>
                                </svg>
                            </div>
                            <span class="subtitle">
                                Quick conversations.
                                <br>
                                Instant answers.
                                <br>
                                Nothing saved.
                            </span>
                        </div>
                        <div class="welcome-input-container">
                            <input type="text" class="welcome-input" placeholder="What would you like to ask today?" id="welcomeInput">
                        </div>
                    </div>
                `;
                
                // Get the new welcome input element and add event listener
                const newWelcomeInput = document.getElementById('welcomeInput');
                if (newWelcomeInput) {
                    newWelcomeInput.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            const message = newWelcomeInput.value.trim();
                            if (message !== '') {
                                messageInput.value = message;
                                controlsContainer.style.display = 'flex';
                                sendMessage();
                                newWelcomeInput.value = '';
                            }
                        }
                    });
                    
                    // Focus on the welcome input
                    newWelcomeInput.focus();
                }
                
                // Hide regular input container
                controlsContainer.style.display = 'none';
                
                // Hide quick answers and deactivate separator line
                quickAnswers.style.display = 'none';
                toggleSeparatorLine(false);
                
                // Hide drawer
                continueSection.classList.remove('visible');
                continueSection.style.display = 'none';
                
                // Reset prompt preview content
                promptPreview.value = '';
                
                // Reset copy notification
                copyNotification.style.display = 'none';
                copyNotification.style.opacity = '0';
            });
            
            // Send message function
            function sendMessage() {
                const message = messageInput.value.trim();
                if (message === '') return;
                
                addUserMessage(message);
                simulateResponse(message);
                
                messageInput.value = '';
                sendBtn.disabled = true;
                messageInput.focus();
            }
            
            // Get formatted timestamp
            function getFormattedTime() {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const formattedHours = hours % 12 || 12;
                const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                return `${formattedHours}:${formattedMinutes} ${ampm}`;
            }
            
            // Add user message to chat
            function addUserMessage(message) {
                currentQuestion = message;
                
                // If this is the first message, clear the welcome message and show controls
                const welcomeMessage = document.querySelector('.welcome-message');
                if (welcomeMessage) {
                    chatMessages.innerHTML = '';
                    
                    // Make sure the controls container is visible
                    controlsContainer.style.display = 'flex';
                    
                    // Change placeholder text for conversation mode
                    messageInput.placeholder = "Type your message here...";
                }
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message-container';
                
                // Create message content wrapper
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                
                // Create time element
                const messageTime = document.createElement('div');
                messageTime.className = 'message-time';
                messageTime.textContent = getFormattedTime();
                
                // Create message body
                const messageBody = document.createElement('div');
                messageBody.className = 'message-body user-message';
                messageBody.textContent = message;
                
                // Assemble the message with time first, then bubble
                messageElement.appendChild(messageTime);
                messageContent.appendChild(messageBody);
                messageElement.appendChild(messageContent);
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Function to format message text with better readability
            function formatMessageText(text) {
                if (!text) return '';
                
                // Replace newlines with <br> for better readability
                let formatted = text.replace(/\n/g, '<br>');
                
                // Bold text: **text** -> <strong>text</strong>
                formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Italic text: *text* -> <em>text</em> (avoiding double asterisks)
                formatted = formatted.replace(/(?<!\*)\*((?!\*).+?)\*/g, '<em>$1</em>');
                
                // Bullet points: - text -> •  text
                formatted = formatted.replace(/- (.*?)(?=<br>|$)/g, '• $1');
                
                return formatted;
            }
            
            function addSystemMessage(message) {
                currentResponse = message;
                
                const messageElement = document.createElement('div');
                messageElement.className = 'message system-message-container';
                
                // Create message content wrapper
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                
                // Create time element
                const messageTime = document.createElement('div');
                messageTime.className = 'message-time';
                messageTime.textContent = getFormattedTime();
                
                // Create message body
                const messageBody = document.createElement('div');
                messageBody.className = 'message-body system-message';
                
                // Use innerHTML to allow for formatted content
                messageBody.innerHTML = formatMessageText(message);
                
                // Assemble the message with time first, then bubble
                messageElement.appendChild(messageTime);
                messageContent.appendChild(messageBody);
                messageElement.appendChild(messageContent);
                
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Show quick answers and activate the separator line
                quickAnswers.style.display = 'flex';
                toggleSeparatorLine(true);
                
                // Hide continue drawer by default until separator is clicked
                continueSection.style.display = 'none';
            }
            
            // Get response from ChatGPT API
            async function simulateResponse(question) {
                try {
                    // Show a loading indicator
                    const loadingMessage = "Thinking...";
                    const loadingElement = document.createElement('div');
                    loadingElement.className = 'message system-message-container';
                    
                    // Create message content wrapper
                    const messageContent = document.createElement('div');
                    messageContent.className = 'message-content';
                    
                    // Create time element
                    const messageTime = document.createElement('div');
                    messageTime.className = 'message-time';
                    messageTime.textContent = getFormattedTime();
                    
                    // Create message body
                    const loadingMessageElement = document.createElement('div');
                    loadingMessageElement.className = 'message-body system-message';
                    loadingMessageElement.textContent = loadingMessage;
                    loadingMessageElement.id = 'loading-message';
                    
                    // Assemble the message with time first, then bubble
                    loadingElement.appendChild(messageTime);
                    messageContent.appendChild(loadingMessageElement);
                    loadingElement.appendChild(messageContent);
                    
                    chatMessages.appendChild(loadingElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Prepare messages for API call
                    const messages = [];
                    
                    // Add all previous messages from the chat
                    document.querySelectorAll('.message').forEach(messageDiv => {
                        const userMessage = messageDiv.querySelector('.user-message');
                        const systemMessage = messageDiv.querySelector('.system-message');
                        
                        if (userMessage && userMessage.textContent !== question) { // exclude current question
                            messages.push({role: 'user', content: userMessage.textContent});
                        } else if (systemMessage && systemMessage.id !== 'loading-message') {
                            // Get the inner HTML, then convert to plain text with proper formatting
                            const systemContent = getTextFromHTML(systemMessage.innerHTML);
                            messages.push({role: 'assistant', content: systemContent});
                        }
                    });
                    
                    // Add the current question
                    messages.push({role: 'user', content: question});
                    
                    // Store current question for the prompt
                    currentQuestion = question;
                    
                    // Try the API first, but have a fallback ready
                    try {
                        // Create a proper messages array for the API - include conversation history
                        // Get existing messages from the chat
                        const chatMsgs = document.querySelectorAll('.message');
                        const messagesForAPI = [];
                        
                        // Build conversation history
                        chatMsgs.forEach(messageDiv => {
                            const userMsg = messageDiv.querySelector('.user-message');
                            const systemMsg = messageDiv.querySelector('.system-message');
                            
                            if (userMsg && userMsg.textContent) {
                                messagesForAPI.push({ role: 'user', content: userMsg.textContent });
                            } else if (systemMsg && systemMsg.id !== 'loading-message') {
                                // Get plain text content
                                const content = systemMsg.textContent || '';
                                if (content) {
                                    messagesForAPI.push({ role: 'assistant', content: content });
                                }
                            }
                        });
                        
                        // Add current question if not already included
                        if (currentQuestion) {
                            // Check if current question is not the last user message
                            const lastUserMsg = messagesForAPI.filter(m => m.role === 'user').pop();
                            if (!lastUserMsg || lastUserMsg.content !== currentQuestion) {
                                messagesForAPI.push({ role: 'user', content: currentQuestion });
                            }
                        }
                        
                        console.log('Sending API request with messages:', messagesForAPI);
                        
                        // API call with timeout (15 seconds)
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), 15000);
                        
                        // Make API call to the server
                        const response = await fetch('/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ 
                                messages: messagesForAPI,
                                model: currentModel 
                            }),
                            signal: controller.signal
                        });
                        
                        clearTimeout(timeoutId); // Clear the timeout if request completes
                        
                        // Process the response
                        if (!response.ok) {
                            throw new Error(`API call failed: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        if (data.error) {
                            throw new Error(data.error);
                        }
                        
                        // Store current response for the prompt 
                        currentResponse = data.message.content;
                        
                        // Remove loading message
                        const loadingMsg = document.getElementById('loading-message');
                        if (loadingMsg) {
                            loadingMsg.parentElement.parentElement.remove();
                        }
                        
                        // Display the API response
                        addSystemMessage(data.message.content);
                        
                        // Don't show continue section automatically - only when "..." is clicked
                        // Show/enable more options button instead
                        toggleSeparatorLine(true);
                        
                        // Update quick answers with dynamic suggestions if available
                        if (data.quickAnswers && Array.isArray(data.quickAnswers)) {
                            updateQuickAnswers(data.quickAnswers);
                        }
                    }
                    catch (apiError) {
                        console.error("API error details:", apiError);
                        console.warn("API error, using client-side fallback instead:", apiError.message);
                        
                        // Fallback to local responses if API fails
                        let response;
                        const lowerQuestion = question.toLowerCase();
                        
                        if (lowerQuestion.includes('hello') || lowerQuestion.includes('hi ')) {
                            response = "Hello! I'm your AI assistant. How can I help you today?";
                        } else if (lowerQuestion.includes('how are you')) {
                            response = "I'm functioning well, thank you for asking! I'm here to assist you with any questions or tasks you might have.";
                        } else if (lowerQuestion.includes('weather')) {
                            response = "I don't have access to real-time weather data. When you use the 'Continue in ChatGPT' feature, you can ask about weather and get more useful responses.";
                        } else if (lowerQuestion.includes('help') || lowerQuestion.includes('can you')) {
                            response = "I'd be happy to help! Please try the 'Continue in ChatGPT' feature, which will allow you to continue this conversation with the full capabilities of GPT-4.";
                        } else if (lowerQuestion.includes('time') || lowerQuestion.includes('date')) {
                            response = "I'm currently operating in fallback mode and don't have access to the current time or date. Try the 'Continue in ChatGPT' feature to get more accurate responses!";
                        } else {
                            response = "I'm currently operating in fallback mode due to API connection issues. Please try the 'Continue in ChatGPT' feature below to continue this conversation in a fresh ChatGPT environment with full capabilities.\n\nThe prompt will summarize our conversation so far, allowing you to seamlessly continue where we left off.";
                        }
                        
                        // Store current response for the prompt
                        currentResponse = response;
                        
                        // Remove loading message
                        const loadingMsg = document.getElementById('loading-message');
                        if (loadingMsg) {
                            loadingMsg.parentElement.parentElement.remove();
                        }
                        
                        // Display the fallback response
                        addSystemMessage(response);
                        
                        // Don't show continue section automatically - only when "..." is clicked
                        // Show/enable more options button instead
                        toggleSeparatorLine(true);
                        
                        // Set default quick answers for fallback mode
                        updateQuickAnswers(["Tell me more", "How does it work?", "Can you elaborate?"]);
                    }
                } catch (error) {
                    console.error('Error getting response:', error);
                    
                    // Remove loading message if it exists
                    const loadingElement = document.getElementById('loading-message');
                    if (loadingElement) {
                        loadingElement.parentElement.parentElement.remove();
                    }
                    
                    // Show error message with more user-friendly text
                    let errorMessage = "Sorry, I couldn't process your request.";
                    
                    if (error.message.includes('NetworkError') || error.message.includes('Failed to fetch')) {
                        errorMessage += " There seems to be a network issue. Please check your connection.";
                    } else if (error.message.includes('timed out')) {
                        errorMessage += " The request took too long to complete. The server might be busy.";
                    } else if (error.message.includes('API call failed: 5')) {
                        errorMessage += " There was a server error. Please try again later.";
                    } else {
                        errorMessage += " You can still test the 'Continue in ChatGPT' feature while we resolve this issue.";
                    }
                    
                    addSystemMessage(errorMessage);
                    
                    // Show some helpful quick answers for error case
                    updateQuickAnswers(["Try again", "Reset chat", "What's happening?"]);
                }
            }
            
            // Generate prompt for continuing in ChatGPT
            // Helper function to convert HTML to plain text (for the prompt)
            function getTextFromHTML(html) {
                // Create a temporary div to hold the HTML
                const temp = document.createElement('div');
                temp.innerHTML = html;
                // Replace <br> tags with newlines
                temp.innerHTML = temp.innerHTML.replace(/<br\s*\/?>/gi, '\n');
                // Return the text content
                return temp.textContent || temp.innerText || '';
            }
            
            function generateChatGPTPrompt() {
                // Get all conversation messages
                const messages = document.querySelectorAll('.message');
                let conversationHistory = [];
                
                // Extract message content from each message div
                messages.forEach(messageDiv => {
                    const userMessage = messageDiv.querySelector('.user-message');
                    const systemMessage = messageDiv.querySelector('.system-message');
                    
                    if (userMessage) {
                        conversationHistory.push({role: 'user', content: userMessage.textContent});
                    } else if (systemMessage && systemMessage.id !== 'loading-message') {
                        // Get the inner HTML, then convert to plain text with proper formatting
                        const systemContent = getTextFromHTML(systemMessage.innerHTML);
                        conversationHistory.push({role: 'assistant', content: systemContent});
                    }
                });
                
                // Create a comprehensive prompt for ChatGPT
                let prompt = `I want to continue this conversation that was started with QuickGPT (powered by GPT-4o). Here's the conversation so far:\n\n`;
                
                // Format conversation history
                conversationHistory.forEach(msg => {
                    prompt += `${msg.role === 'user' ? 'Me' : 'Assistant'}: ${msg.content}\n\n`;
                });
                
                // Add instructions for continuation
                prompt += `Please continue this conversation where we left off, keeping in mind the context and topic we were discussing. You should respond as if you are the assistant in this conversation.\n\n`;
                
                // Add next steps instructions
                prompt += `When you respond, please take into account the entire conversation history above. Your next response should be a direct continuation of this conversation, as if we never stopped talking. You don't need to remind me of what we were discussing, just continue the natural flow of our conversation.`;
                
                promptPreview.value = prompt;
            }
        });
    </script>
</body>
</html>
